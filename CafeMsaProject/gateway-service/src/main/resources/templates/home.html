<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Cafe MSA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- ✅ 공통 스타일 -->
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <!-- AOS 라이브러리 추가 (스크롤 애니메이션) -->
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

    <!-- ✅ 일반 스크롤 스타일 -->
    <style>
        /* ========== 일반 스크롤 설정 ========== */
        html, body {
            height: 100%;
            margin: 0;
        }

        /* Hero 섹션 */
        .hero {
            position: relative;
            min-height: 100vh;
            display: flex;
            align-items: center;
            overflow: hidden;
        }

        /* 추천 메뉴 섹션 */
        .section {
            min-height: auto;
            padding: 5rem 0;
        }

        /* 네비게이션 바 */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 1030;
        }

        /* 푸터 */
        .footer {
            position: relative;
            margin-top: 0;
        }

        /* ========== 제품 카드 스타일 ========== */
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 28px rgba(0,0,0,0.15);
        }

        .feature-card:hover .product-image {
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        /* ========== 가로 스크롤 컨테이너 ========== */
        .products-scroll-section {
            width: 100%;
            max-height: 70vh;
            display: flex;
            align-items: center;
        }

        .products-scroll-container {
            overflow-x: auto;
            overflow-y: hidden;
            cursor: grab;
            user-select: none;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            padding: 1rem 0;
            width: 100%;
        }

        .products-scroll-container:active {
            cursor: grabbing;
        }

        .products-scroll-wrapper {
            display: flex;
            gap: 1.5rem;
            padding: 0 2rem;
            width: max-content;
        }

        .product-card-item {
            flex: 0 0 320px;
            max-width: 320px;
        }

        /* 스크롤바 스타일링 */
        .products-scroll-container::-webkit-scrollbar {
            height: 8px;
        }

        .products-scroll-container::-webkit-scrollbar-track {
            background: #f1e3d6;
            border-radius: 10px;
        }

        .products-scroll-container::-webkit-scrollbar-thumb {
            background: var(--coffee);
            border-radius: 10px;
        }

        .products-scroll-container::-webkit-scrollbar-thumb:hover {
            background: #4b2b1d;
        }

        /* 스크롤 힌트 */
        .scroll-hint {
            text-align: center;
            color: var(--coffee);
            font-size: 0.9rem;
            margin-top: 1rem;
            opacity: 0.7;
            animation: fadeInOut 2s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        /* Hero 이미지 높이 조정 */
        .hero-img {
            min-height: 280px;
            height: 400px;
            max-height: 500px;
        }

        /* 아래로 스크롤 힌트 애니메이션 */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        /* ========== 반응형 ========== */
        @media (max-width: 991px) {
            .hero {
                min-height: 80vh;
            }

            .hero-img {
                height: 300px;
                margin-top: 2rem;
            }

            .section {
                padding: 3rem 0;
            }
        }

        @media (max-width: 768px) {
            .products-scroll-wrapper {
                flex-direction: column;
                padding: 0 1rem;
                width: 100%;
            }

            .product-card-item {
                flex: 1 0 auto;
                max-width: 100%;
            }

            .scroll-hint {
                display: none;
            }

            .hero-img {
                height: 250px;
            }
        }
    </style>
</head>
<body class="body-cream">

<!-- ✅ 고정 네비게이션 -->
<div th:replace="~{fragments/nav :: mainNav}"></div>

<!-- ========== HERO 섹션 ========== -->
<section class="hero">
    <div class="container">
        <div class="row g-4 align-items-center">
            <div class="col-lg-6">
                <span class="badge rounded-pill mb-3 px-3 py-2 text-dark" data-aos="fade-up">
                    오늘도 한 잔의 여유를, Cafe MSA
                </span>
                <h1 class="display-5 fw-bold mb-3" data-aos="fade-up" data-aos-delay="100">
                    한 잔의 집중, <span style="color:#ffd9b3;">Cafe MSA</span>
                </h1>
                <p class="lead mb-4" style="opacity:.9" data-aos="fade-up" data-aos-delay="200">
                    마이크로서비스로 구현된 커피 전문점 데모. 상품 관리, 장바구니, 주문까지
                    하나의 잔처럼 부드럽게 흐르는 경험을 제공합니다.
                </p>
                <div class="d-flex flex-wrap gap-3" data-aos="fade-up" data-aos-delay="300">
                    <a href="/products" class="btn btn-light btn-lg px-4">
                        <i class="bi bi-cup-hot me-1"></i>메뉴 보러가기
                    </a>
                    <a href="/login" class="btn btn-outline-light btn-lg px-4" id="primaryOrderBtn">
                        <i class="bi bi-box-arrow-in-right me-1"></i>로그인하고 시작하기
                    </a>
                </div>
            </div>
            <div class="col-lg-6" data-aos="fade-left" data-aos-delay="400">
                <div class="hero-img"></div>
            </div>
        </div>
    </div>

    <!-- 아래로 스크롤 힌트 -->
    <div class="text-center position-absolute start-50 translate-middle-x" style="bottom: 80px; z-index: 10;">
        <div class="text-white" style="animation: bounce 2s infinite;">
            <i class="bi bi-chevron-down fs-2"></i>
        </div>
    </div>
</section>

<!-- ========== 추천 메뉴 섹션 ========== -->
<section class="section">
    <div class="container">
        <div class="text-center mb-5" data-aos="fade-up">
            <h2 class="fw-bold" style="color:var(--coffee)">추천 메뉴</h2>
            <p class="text-muted mb-0">가볍게 시작해 보세요. 장바구니로 담으면 끝!</p>
        </div>

        <!-- 가로 스크롤 제품 카드 -->
        <div class="products-scroll-section" data-aos="fade-up" data-aos-delay="100">
            <div class="products-scroll-container" id="productsScroll">
                <div class="products-scroll-wrapper">

                    <!-- 아메리카노 -->
                    <div class="product-card-item">
                        <div class="card feature-card h-100">
                            <div class="card-body">
                                <img src="https://d2afncas1tel3t.cloudfront.net/wp-content/uploads/211001_%EB%B9%85%EC%95%84%EC%9D%B4%EC%8A%A4%EC%95%84%EB%A9%94%EB%A6%AC%EC%B9%B4%EB%85%B8-1280-1280x1280.jpg"
                                     alt="아메리카노"
                                     class="product-image"
                                     draggable="false">

                                <div class="d-flex align-items-center mb-3">
                                    <div class="icon-wrap me-2"><i class="bi bi-droplet-half"></i></div>
                                    <h5 class="mb-0">아메리카노</h5>
                                    <span class="ms-auto price-chip">2,000원</span>
                                </div>
                                <p class="text-muted mb-3">담백하고 깔끔한 원두 본연의 맛.</p>
                                <div class="d-flex gap-2">
                                    <a href="/products" class="btn btn-sm btn-outline-secondary">자세히</a>
                                    <button class="btn btn-sm btn-primary" onclick="addToCartAndRedirect(2)">
                                        <i class="bi bi-bag-plus me-1"></i>담기
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 카라멜 마끼아또 -->
                    <div class="product-card-item">
                        <div class="card feature-card h-100">
                            <div class="card-body">
                                <img src="https://i.namu.wiki/i/HrZbb-CBP2ppoN4Rqu_Hit-xeDYIpMfpCZFTI57yNAB43sM5xH8mFzGdWCiDG0ieu0VWOMfZsNYmsxji86o5jiQ8oW_rmQ2J3KkmMdaG_hh2L4tIKEGnQE4FbXqjahh5o6WRVgAa-UB9kpHrOspgig.webp"
                                     alt="카라멜 마끼아또"
                                     class="product-image"
                                     draggable="false">

                                <div class="d-flex align-items-center mb-3">
                                    <div class="icon-wrap me-2"><i class="bi bi-stars"></i></div>
                                    <h5 class="mb-0">카라멜 마끼아또</h5>
                                    <span class="ms-auto price-chip">3,300원</span>
                                </div>
                                <p class="text-muted mb-3">달콤한 카라멜과 에스프레소의 조화.</p>
                                <div class="d-flex gap-2">
                                    <a href="/products" class="btn btn-sm btn-outline-secondary">자세히</a>
                                    <button class="btn btn-sm btn-primary" onclick="addToCartAndRedirect(3)">
                                        <i class="bi bi-bag-plus me-1"></i>담기
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 아이스티 -->
                    <div class="product-card-item">
                        <div class="card feature-card h-100">
                            <div class="card-body">
                                <img src="https://previews.123rf.com/images/bhofack2/bhofack21208/bhofack2120800512/14876689-refreshing-iced-tea-with-lemon-against-a-background.jpg"
                                     alt="아이스티"
                                     class="product-image"
                                     draggable="false">

                                <div class="d-flex align-items-center mb-3">
                                    <div class="icon-wrap me-2"><i class="bi bi-ice-cream"></i></div>
                                    <h5 class="mb-0">아이스티</h5>
                                    <span class="ms-auto price-chip">3,000원</span>
                                </div>
                                <p class="text-muted mb-3">상큼하고 시원한 휴식 한 잔.</p>
                                <div class="d-flex gap-2">
                                    <a href="/products" class="btn btn-sm btn-outline-secondary">자세히</a>
                                    <button class="btn btn-sm btn-primary" onclick="addToCartAndRedirect(1)">
                                        <i class="bi bi-bag-plus me-1"></i>담기
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 카페라떼 -->
                    <div class="product-card-item">
                        <div class="card feature-card h-100">
                            <div class="card-body">
                                <img src="https://i.namu.wiki/i/ruFM6Lv1TOS4Hsgd8yluuFK4g_aCrd5MvC2KQ40YbCe1VTSO7DmnRvSoCSPwRj7vZ9i857J1q2BfxVLJRvudYPeLsxxRR-Cnst-9CsdcHdtbbwXvWYAYp-SD29O5AHGlTCe56dITu30_5MetatGXLQ.webp"
                                     alt="카페라떼"
                                     class="product-image"
                                     draggable="false">

                                <div class="d-flex align-items-center mb-3">
                                    <div class="icon-wrap me-2"><i class="bi bi-cup-straw"></i></div>
                                    <h5 class="mb-0">카페라떼</h5>
                                    <span class="ms-auto price-chip">2,900원</span>
                                </div>
                                <p class="text-muted mb-3">에스프레소와 스팀 우유의 조화.</p>
                                <div class="d-flex gap-2">
                                    <a href="/products" class="btn btn-sm btn-outline-secondary">자세히</a>
                                    <button class="btn btn-sm btn-primary" onclick="addToCartAndRedirect(4)">
                                        <i class="bi bi-bag-plus me-1"></i>담기
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- 스크롤 힌트 -->
        <div class="scroll-hint">
            <i class="bi bi-arrows-expand"></i> 드래그해서 더 많은 메뉴를 확인하세요
        </div>
    </div>
</section>

<!-- 푸터 -->
<div th:replace="~{fragments/footer :: mainFooter}"></div>

<!-- AOS 라이브러리 -->
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
    AOS.init({
        duration: 1000,
        easing: 'ease-in-out',
        once: false,
        mirror: true
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/nav-common.js}"></script>

<!-- 드래그 스크롤 기능 -->
<script>
    const scrollContainer = document.getElementById('productsScroll');

    let isDown = false;
    let startX;
    let scrollLeft;

    scrollContainer.addEventListener('mousedown', (e) => {
        isDown = true;
        scrollContainer.style.cursor = 'grabbing';
        startX = e.pageX - scrollContainer.offsetLeft;
        scrollLeft = scrollContainer.scrollLeft;
    });

    scrollContainer.addEventListener('mouseleave', () => {
        isDown = false;
        scrollContainer.style.cursor = 'grab';
    });

    scrollContainer.addEventListener('mouseup', () => {
        isDown = false;
        scrollContainer.style.cursor = 'grab';
    });

    scrollContainer.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - scrollContainer.offsetLeft;
        const walk = (x - startX) * 2;
        scrollContainer.scrollLeft = scrollLeft - walk;
    });

    // 터치 디바이스 지원
    let touchStartX = 0;
    let touchScrollLeft = 0;

    scrollContainer.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].pageX - scrollContainer.offsetLeft;
        touchScrollLeft = scrollContainer.scrollLeft;
    });

    scrollContainer.addEventListener('touchmove', (e) => {
        const x = e.touches[0].pageX - scrollContainer.offsetLeft;
        const walk = (x - touchStartX) * 2;
        scrollContainer.scrollLeft = touchScrollLeft - walk;
    });
</script>

<!-- 장바구니 담기 함수 -->
<script>
    async function addToCartAndRedirect(productId) {
        const token = localStorage.getItem('token');
        const username = localStorage.getItem('username');

        if (!token || !username) {
            alert('로그인이 필요합니다.');
            location.href = '/login';
            return;
        }

        const userId = localStorage.getItem('userId')
            || localStorage.getItem('USER_ID')
            || sessionStorage.getItem('USER_ID')
            || '1';

        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>담는 중...';

        try {
            const response = await fetch('/api/cart/items', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-USER-ID': String(userId)
                },
                body: JSON.stringify({
                    productId: productId,
                    quantity: 1
                })
            });

            if (!response.ok) {
                throw new Error('장바구니 담기에 실패했습니다.');
            }

            location.href = '/cart';

        } catch (error) {
            console.error('장바구니 담기 실패:', error);
            alert('장바구니에 담는 중 오류가 발생했습니다.');

            btn.disabled = false;
            btn.innerHTML = originalHTML;
        }
    }
</script>
</body>
</html>