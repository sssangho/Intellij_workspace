<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>User CRUD UI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, button { margin: 5px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>

<h1>User CRUD UI</h1>

<!-- User Form -->
<div>
    <input type="hidden" id="id">
    <input type="text" id="username" placeholder="이름">
    <input type="text" id="password" placeholder="이메일">
    <button onclick="createOrUpdateUser()">저장</button>
    <button onclick="clearForm()">취소</button>
</div>

<!-- User List -->
<table id="userTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>이름</th>
        <th>암호</th>
        <th>동작</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script src="https://jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const API_URL = 'http://localhost:8960/api/users';

    // 문서가 로드되면 사용자 목록 불러오기

    $(document).ready(function () {
        fetchUsers()
    });

    // 사용자 목록 조회
    function fetchUsers() {
        $.ajax({
            url: API_URL,
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                const tbody = $('#userTable tbody');
                tbody.empty();

                data.forEach(function (user) {
                    const row = `
                    <tr>
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.password}</td>
                    <td>
                         <button onclick="editUser(${user.id}, '${user.username}', ${user.password})">수정</button>
                         <button onclick="deleteUser(${user.id})">삭제</button>
                    <td>
                    </tr>
                `;
                    tbody.append(row);
                });
            },
            error: function () {
                alert('사용자 목록 불러오기 실패');
            }
        });
    }

    // 사용자 생성 또는 수정
    function createOrUpdateUser() {
        const id = $('#id').val();
        const username = $('#username').val().trim();
        const password = $('#password').val().trim();

        if (!username || !password) {
            alert('이름과 암호를 입력하세요.');
            return;
        }

        const user = { username, password };
        const method = id ? 'PUT' : 'POST';
        const url = id ? `${API_URL}/${id}` : API_URL;

        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(user),
            success: function () {
                fetchUsers();
                clearForm();
            },
            error: function () {
                alert('저장 실패');
            }
        })
    }

    // 사용자 삭제
    function deleteUser(id) {
        if (!confirm('정말 삭제하시겠습니까?')) return;

        $.ajax({
            url: `${API_URL}/${id}`,
            method: 'DELETE',
            success: function () {
                fetchUsers();
            },
            error: function () {
                alert('삭제 실패');
            }
        })
    }

    // 사용자 정보 편집
    function editUser(id, username, password) {
        $('#id').val(id);
        $('#username').val(username);
        $('#password').val(password);
    }

    // 폼 초기화
    function clearForm() {
        $('#id').val('');
        $('#username').val('');
        $('#password').val('');
    }
</script>

</body>
</html>